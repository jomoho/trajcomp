library(trajcomp)
data(prague)

#get trajectory
prague$tid = getTrajectoryIDs(prague); # Add ID column
# and split on it
psplit = split (prague, f = prague$tid);


get_lengths <- function(fn, tr, ...){
  lens <-c()
  for(t in tr){
    x <- fn(as.matrix(t), ...)
    if(length(x)> 2)
      lens <- c(lens,length(x))
  }
  return(lens)
}

get_len_len <- function(tr){
  lens <-c()
  for(t in tr){
      lens <- c(lens, length(as.matrix(t)/3))
  }
  return(lens)
}
get_distances <- function(fn, tr, handle, ...){
  dists <-c()
  for(t in tr){
    x <- fn(as.matrix(t), ...)
    if(length(x)> 2){
      dists <- c(dists, distance_vector_ddply(as.matrix(x),as.matrix(t),handle))
    }
  }
  return(dists)
}


handle = compileSettings(
  tgroup(
    tdistance("discrete_hausdorff"),
    tdistance("dtw"),
    tdistance("closest_pair"),
    tdistance("sum_of_pairs") #,tdistance("discrete_frechet")
  ));

len_len <- get_len_len(psplit)
psp_len <- get_lengths(persistence_pruned, psplit, 16)
psm_len <- get_lengths(PersistenceMRS, psplit, 8, 7)
psd_len <- get_lengths(PersistenceSDS, psplit, 5,32, 2)
dp_len <- get_lengths(DouglasPeucker, psplit, 32)

psp_dst <- get_distances(persistence_pruned, psplit, handle, 16)
psm_dst <- get_distances(PersistenceMRS, psplit, handle, 8, 7)
psd_dst <- get_distances(PersistenceSDS, psplit, handle, 5,32, 2)
dp_dst <- get_distances(DouglasPeucker, psplit, handle, 32)

plot(sort(dp_len), ylim=c(0,30), cex=1.7)
points(sort(psd_len), col="blue")
points(sort(psm_len), col="red", cex =0.5)
points(sort(psp_len), col="green", cex =0.2)
legend('topleft', 
       c("DP", "PS D", "PS MR", "PS PRU"), 
       col = c("black", "blue", "red", "green"), 
       lty = c(), 
       pch = c(1,1,1,1), 
       bty="n")


hau <- c(TRUE, FALSE, FALSE, FALSE)
dtw <- c(FALSE, TRUE, FALSE, FALSE)

cpair <- c(FALSE, FALSE, TRUE, FALSE)
spair <- c(FALSE, FALSE, FALSE, TRUE)

plot(sort(psm_dst[hau]), 
     ylim=c(0, 700), 
            cex=0.7, main="hausdorff distance",
     type="n")
lines(sort(dp_dst[hau]),  col="black")
lines(sort(psd_dst[hau]), col="blue")
lines(sort(psm_dst[hau]), col="red", cex =1.5)
lines(sort(psp_dst[hau]), col="green")
legend('topleft', 
       c("DP", "PS D", "PS MR", "PS PRU"), 
       col = c("black", "blue", "red", "green"), 
       lty = c(), 
       pch = c(1,1,1,1), 
       bty="n")

plot(sort(dp_dst[dtw]),
     ylim=c(0, 7), 
     cex=0.7, main="DTW distance normalized", type="n")
lines(sort(dp_dst[dtw]/len_len), col="black")
lines(sort(psd_dst[dtw]/len_len), col="blue")
lines(sort(psm_dst[dtw]/len_len), col="red")
lines(sort(psp_dst[dtw]/len_len), col="green")
legend('topleft', 
       c("DP", "PS D", "PS MR", "PS PRU"), 
       col = c("black", "blue", "red", "green"), 
       lty = c(), 
       pch = c(1,1,1,1), 
       bty="n")

plot(sort(dp_dst[dtw]),
     ylim=c(0, 3000), 
     cex=0.7, main="DTW distance", type="n")
lines(sort(dp_dst[dtw]), col="black")
lines(sort(psd_dst[dtw]), col="blue")
lines(sort(psm_dst[dtw]), col="red")
lines(sort(psp_dst[dtw]), col="green")
legend('topleft', 
       c("DP", "PS D", "PS MR", "PS PRU"), 
       col = c("black", "blue", "red", "green"), 
       lty = c(), 
       pch = c(1,1,1,1), 
       bty="n")

plot(sort(dp_dst[hau]*psm_len),
     ylim=c(0, 10000), 
     cex=0.7, main="hausdorff * length", type="n")
lines(sort(dp_dst[hau]*dp_len), col="black")
lines(sort(psd_dst[hau]*psd_len), col="blue")
lines(sort(psm_dst[hau]*psm_len), col="red",)
lines(sort(psp_dst[hau]*psp_len), col="green")
legend('topleft', 
       c("DP", "PS D", "PS MR", "PS PRU"), 
       col = c("black", "blue", "red", "green"), 
       lty = c(), 
       pch = c(1,1,1,1), 
       bty="n")

plot(sort(dp_dst[cpair]),
     ylim=c(-10, 10), 
     cex=0.7, main="closest pair", type="n")
lines(sort(dp_dst[cpair]), col="black")
lines(sort(psd_dst[cpair]), col="blue")
lines(sort(psm_dst[cpair]), col="red",)
lines(sort(psp_dst[cpair]), col="green")
legend('topleft', 
       c("DP", "PS D", "PS MR", "PS PRU"), 
       col = c("black", "blue", "red", "green"), 
       lty = c(), 
       pch = c(1,1,1,1), 
       bty="n")

